# 1. 运行环境

- java version "1.8.0_391"
  Java(TM) SE Runtime Environment (build 1.8.0_391-b13)
  Java HotSpot(TM) 64-Bit Server VM (build 25.391-b13, mixed mode)
- Apache Tomcat Version 9.0.83
- mysql  Ver 8.0.35 for Win64 on x86_64 (MySQL Community Server - GPL)

# 2. 运行说明

**1. 配置MySQL**

以ROOT用户身份登录MySQL，依次运行建库、建表、导入数据脚本。

```
$ mysql -u root -p 
source ./database/create_database.sql
source ./database/create_tables.sql
source ./database/import_data.sql
```

此外，`drop.sql` 用于在创建表失败或回到初始化状态时，一键删除 `cardb` 数据库中的各个表。

**2. 配置Tomcat**



**3. 登录网站**

提供两个可登录用户：

- 管理员：账号：`admin`，密码：`123456`
- 用户：账号：`user`，密码：`123456`


# 3. 项目结构

项目结构如下图所示：

```
.
├─source
│  ├─.idea
│  │  ├─artifacts
│  │  └─libraries
│  ├─src
│  │  └─com
│  │      └─EasyRide
│  │          ├─dao
│  │          ├─entity
│  │          ├─servlet
│  │          │  ├─admin
│  │          │  └─customer
│  │          └─util
│  └─web
│      ├─admin
│      │  ├─js
│      │  └─style
│      ├─customer
│      │  ├─js
│      │  └─style
│      ├─images
│      └─WEB-INF
│          └─lib
├─target
└─database
```

## 3.1 根目录结构

其中，在根目录下：

- `source` 目录中存放有本项目实现的所有源码，包括Java代码和JSP页面的代码。
- `tatget` 目录中存有可运行系统二进制文件打包文件，具体为JAVA web打包的war文件。
- `database` 目录中存放有初始化数据库所需的脚本文件。

除此之外，在根目录下还存放有数据库概念、逻辑、物理设计文档，系统详细设计文档，源代码说明文件和系统运行结果截图等。

## 3.2 代码目录结构

`.\source\src`:

- 这是项目的源代码文件夹，包含了 Java 源代码文件。
- `com` 文件夹通常是Java包的根目录。
- `EasyRide` 是项目的包名、命名空间。
- `dao` 存放数据访问对象（Data Access Object）类，用于与数据库交互。
- `entity` 存放实体类，用于表示数据库表中的实体结构，以及其他需要的实体类。
- `servlet` 存放Servlet类，分为 `admin` 和 `customer` 子文件夹，表示管理员和顾客相关的Servlet交互操作。
- `util` 存放通用的工具类，用于提供各种辅助功能。

`.\source\web`:

- 这是Web应用程序的根目录，包含前端资源文件和JSP文件。
- `admin` 和 `customer` 子文件夹包含与管理员和顾客相关的前端资源。
- `js` 存放JavaScript文件。
- `style` 存放CSS文件。
- `images` 存放项目使用的图像文件。

`.\source\WEB-INF`:

- 这是Web应用程序的特殊目录，包含与安全性和配置相关的文件。
- `lib` 存放项目依赖的外部库（JAR文件），用于数据库连接、框架支持等。

# 4. 源代码文件详细说明

这个项目采用了MVC（Model-View-Controller）设计模式，该模式将应用程序的不同组成部分分开，从而提高了代码的可维护性和可扩展性。

接下来将分别介绍这三个层次，并详细说明源代码文件。

## 4.1 模型（Model）

### 4.1.1 DAO

在模型层的DAO（Data Access Object）包中，存放了与数据库交互相关的类，用于处理数据的存储和检索。这些类可能包括数据库连接池配置、SQL查询语句的执行、事务管理等。

- `AdministratorDao.java`，实现获取管理员信息，根据账号或是管理员ID获取管理员信息、更新管理员资料和删除管理员等操作。
- `CarDao.java`，实现获取所有车辆信息，通过车辆ID查找车辆、筛选不同状态的车辆、增加或删除车辆、更新车辆信息还有根据条件过滤车辆。
- `CarModelDao.java`，实现根据modelID获取型号信息、根据品牌和获取所有该品牌车辆型号信息、获取所有车辆型号、添加删除车辆型号等功能
- `CustomerDao.java`，实现获取所有客户信息、通过客户ID查找客户、通过驾驶证号码查找客户、通过账号查找客户信息、更新客户资料和删除客户等操作。
- `PaymentDao.java`，实现通过租赁信息查找对应的支付记录、统计从指定日期之后的支付总金额、统计过去一年的支付信息、添加删除支付记录等功能。
- `RentalRecordDao.java`，实现通过租赁ID查找租赁信息、通过客户ID查找租赁信息、通过车辆ID查找租赁信息、统计某个品牌的租赁信息、统计所有租赁信息、添加删除租赁记录等功能。
- `ReturnRecordDao.java`，实现通过还车单ID查找还车记录、添加删除还车记录等功能。
- `SystemLog.java`，实现通过管理员ID查找管理员日志、通过客户ID查找客户日志、添加删除日志等功能。
- `ViolationRecordDao.java`，实现添加违约记录、通过租赁ID查找违约记录等功能。

### 4.1.2 Entity

Entity包中包含了用于表示数据库表结构的实体类，每个类通常对应数据库中的一张表。这些实体类包含表字段的属性和相关的方法。
- `Administrator.java`，管理员实体类，包含管理员ID、账号、密码、姓名、联系方式、角色、创建时间等属性。
- `Brand_Count.java`，品牌-数量实体类，包含品牌字段和对应数量。
- `BrandStats`，品牌状态实体类，品牌名、租赁总天数、总共的租赁金额等属性。
- `Car.java`，车辆实体类，包含车辆ID、车辆型号、品牌、车辆描述、车牌号码、颜色、出厂年份、现在的状态、日租金等信息。
- `CarModel.java`，车辆型号实体类，包含车型ID，品牌车型名称字段和描述等属性。
- `Customer.java`，客户实体类，客户ID、客户姓名、账号密码、联系方式、驾驶证号码和居住地址等信息。
- `Payment.java`，支付信息实体类，包含支付信息ID、租赁ID、支付类型、支付时间、支付金额和支付方式等信息。
- `RentalRecord.java`，租赁记录实体类，包含租赁ID、客户ID、车辆ID、租赁开始日期、预计的租赁结束日期、实际租赁的结束日期、总的租赁费用和订单状态等信息。
- `ReturnRecord.java`，还车记录实体类，包含还车ID、对应的租赁ID、还车时间、还车时车辆状态描述和处理本次还车的管理员ID等信息。
- `SystemLog.java`，系统操作实体类，包含操作记录ID、操作类型、操作内容、操作人员ID、操作的时间、操作人员ip记录和操作结果等信息。
- `ViolationRecord.java`，违约记录实体类，包含违约记录ID、对应的租赁ID、违约类型和违约罚金数量等信息。

## 4.2 控制器（Controller）

### 4.2.1 Customer

在控制器层的 `./source/src/com/EasyRide/servlet/customer` 包中，存放了处理顾客相关请求的Servlet类。这些类负责接收来自前端的请求，执行相应的业务逻辑，并与模型层协作来处理数据。

- `login` 类是一个用于处理登录请求的Servlet，它验证用户账号和密码，若验证失败则显示错误信息并重定向到登录页面，验证成功则将用户信息存入会话并跳转到用户主页。
- `register` 类是一个处理用户注册请求的Servlet，它接收用户提交的注册信息，检查账号和驾驶证号是否已被注册，若未被注册则创建新用户，注册成功后将用户信息存入会话并跳转到用户主页，注册失败或账号/驾驶证号已存在则返回错误信息并重定向回注册页面。
- `updateProfile` 类是一个用于处理用户资料更新请求的Servlet。它接收用户提交的新资料，验证账号和驾照号是否已被其他用户使用，如果未被使用，则更新用户信息。更新成功后，用户信息在会话中更新，并重定向到用户主页，如果验证失败或更新失败，则返回错误信息并重定向回更新资料页面。
- `filterCars` 类是一个处理汽车筛选请求的Servlet，用于根据用户提供的筛选条件（品牌、模型、颜色、年份、状态、日租金范围）来检索汽车。它从请求中提取筛选参数，使用这些参数从数据库中获取相应的汽车列表，并将结果存储在会话中。最后，Servlet将用户重定向到汽车租赁页面，显示根据筛选条件筛选出的汽车列表。
- `getModelsByBrand` 类是一个用于处理根据汽车品牌获取相应车型的请求的Servlet。它从请求中获取品牌参数，然后查询数据库以获取该品牌下的所有车型。这些车型信息被构建成JSON格式的响应数据，最后该JSON数据被发送回客户端。这个类主要用于动态填充基于用户选择的品牌的车型下拉菜单。
- `checkReturnTime` 类是一个处理汽车还车时间检查的Servlet。它首先获取并验证租赁记录的状态，如果状态为“已完成”或“已取消”，则提示用户并重定向到用户主页。如果车辆尚未归还，该类会计算实际归还日期与预期归还日期之间的天数差异。如果存在逾期，它会计算逾期罚款并将请求转发到支付页面；如果没有逾期，它将请求转发到还车处理页面。
- `checkTimeoutRental` 类是一个处理检查是否有超时租车记录的Servlet。对于已登录的用户，该类检查该用户是否有任何超时未还的租车记录。如果有超时记录，它会显示一个警告消息并重定向用户回到用户主页。如果没有超时记录，Servlet会处理租车或者续租请求，并转发到支付页面。
- `rentalCar` 类是一个处理汽车租赁请求的Servlet。它检查选定的汽车是否已经被租赁，如果已经被租赁，则显示一个警告并重定向用户回到租车页面。如果汽车可用，它会创建一个新的租赁记录和相应的支付记录，并更新汽车的状态为“已租赁”。操作完成后，显示一个成功消息并重定向用户回到用户主页。
- `renewCar` 类是一个处理汽车续租请求的Servlet。它修改对应的租赁记录，包括更新预期归还日期和租赁费用。接着，它创建一个新的支付记录来记录续租费用的支付。完成这些操作后，Servlet 会显示一个续借成功的提示消息，并将用户重定向回用户主页。
- `returnCar` 类是一个处理汽车归还请求的Servlet。该类首先创建还车记录，如果创建失败则显示错误消息并重定向到用户主页。如果有额外时长，则创建相应的支付记录。随后，它更新租赁记录的状态和租赁费用，并更新汽车的状态为可用。操作完成后，显示归还成功的消息并重定向用户回到用户主页。
- `LogoutServlet` 类是一个用于处理用户登出请求的Servlet。它使当前用户会话失效来实现用户注销功能，并在注销后将用户重定向到登录页面。

### 4.2.2 Admin

在控制器层的Admin包中，存放了处理管理员相关请求的Servlet类。这些类也负责接收管理员端的请求，执行相应的操作，并与模型层交互。
- `login`，类是一个用于处理登录请求的Servlet，它验证管理员账号和密码，若验证失败则显示错误信息并重定向到登录页面，验证成功则将管理员信息存入会话并跳转到管理员主页。
- `LogoutServlet` 类是一个用于处理管理员登出请求的Servlet。它使当前管理员会话失效来实现管理员注销功能，并在注销后将管理员重定向到登录页面。
- `statsBrands` 类是一个用于处理统计品牌租赁信息的Servlet。它从数据库中获取过去一年内的租赁信息，然后统计每个品牌的租赁次数和总租赁金额。这些统计信息被构建成JSON格式的响应数据，最后该JSON数据被发送回客户端。这个类主要用于动态填充品牌租赁信息饼状图。
- `updateProfile` 类是一个用于处理管理员资料更新请求的Servlet。它接收管理员提交的新资料，验证账号和驾照号是否已被其他用户使用，如果未被使用，则更新管理员信息。更新成功后，管理员信息在会话中更新，并重定向到管理员主页，如果验证失败或更新失败，则返回错误信息并重定向回更新资料页面。

## 4.3 视图（View）

- `index.jsp` ：文件作为汽车租赁系统的主页，提供了三个主要功能：允许普通用户登录、新用户注册以及管理员登录。通过三个不同的表单，用户可以选择进入相应的登录或注册页面。

### 4.3.1 Customer

在视图层的`./source/web/customer/` 包中，通常存放了与顾客界面相关的JSP文件、JavaScript脚本和CSS样式表。这些文件用于渲染顾客端的用户界面。

- `login.jsp` 是客户登录页面。它提供了一个表单，用于用户输入账号和密码进行登录，一个按钮用于跳转到用户注册页面，以及一个返回首页的按钮。
- `register.jsp` 是用户注册页面。页面上提供一个注册表单，用户填写个人信息后，用于新用户创建账户。
- `user.jsp` 是用户个人页面，在页面上示用户的基本信息，并提供提供用户信息更新和登出的功能。并展示用户的租车记录，分为“正在进行中”和“已完成”的租车记录两部分，每部分包含租车详情和操作按钮。提供一个按钮用于查询可用车辆并租赁新车辆。
- `updateProfile.jsp` 是用户资料更新页面。在页面上提供一个表单，允许用户更新他们的个人资料，并发送到服务器进行更新处理。
- `rentalCar.jsp` 是汽车租赁页面。页面提供一个筛选表单，允许用户根据品牌、型号、颜色、年份、状态和可接受价格区间筛选汽车。展示筛选后的汽车列表，包括汽车的详细信息。对于客户角色，提供输入框用于输入租赁天数，并提交租车请求；对于管理员角色，提供查看汽车详细信息的功能。
- `payment.jsp` 是支付确认页面。显示待支付款项的详细信息，以及所需支付的总费用；若存在逾期罚款，显示调整后的总费用（通常为正常价格的三倍）。提供一个表单供用户确认支付。
- `rentalDetail.jsp` 是租赁记录详细信息页面。在页面上根据租赁记录ID显示租车记录的详细信息以及相关的支付详情。对于进行中的租赁，提供续租和还车的选项。对于已完成的租赁，展示归还详情。
- `js/filter.js` 是用于筛选汽车的JavaScript脚本。在汽车租赁页面，当用户在下拉菜单中选择一个汽车品牌后，脚本动态加载对应的车型到另一个下拉菜单中。并验证用户输入的筛选租金范围和租车天数是否为有效数字。
- `js/checkInput.js` 用于检查注册页面两次重复输入的密码是否相同。
- `js/user.js` 用于用户个人页面的表格展示和隐藏效果。
- `style` 文件夹中存储与网页展示样式有关的CSS代码文件。

### 4.3.2 Admin

在视图层的Admin包中，存放了与管理员界面相关的JSP文件、JavaScript脚本和CSS样式表。这些文件用于渲染管理员端的用户界面。

- `login.jsp` 是管理员登录页面。它提供了一个表单，用于管理员输入账号和密码进行登录，一个按钮用于跳转到用户注册页面，以及一个返回首页的按钮。
- `user.jsp` 是管理员个人页面，在页面上示管理员的基本信息和整个租车系统的一部分重要的统计信息，包括过去十二个月内的总体租赁信息柱状图和过去一年的各个品牌的租赁情况饼状图，同时提供数据导出按钮，并提供提供管理员信息更新和登出的功能。并展示管理员的操作日志，每部分包含操作日志详情和操作按钮。提供一个按钮用于查看所有车辆信息。
- `updateProfile.jsp` 是管理员资料更新页面。在页面上提供一个表单，允许管理员更新他们的个人资料，并发送到服务器进行更新处理。
- `editCar.jsp` 是车辆信息编辑页面。在页面上提供一个表单，允许管理员更新车辆的详细信息，并发送到服务器进行更新处理。
- `editCustomer.jsp` 是客户信息编辑页面。在页面上提供一个表单，允许管理员更新客户的详细信息，并发送到服务器进行更新处理。
- `editSystemLog.jsp` 是系统日志编辑页面。在页面上提供一个表单，允许管理员更新系统日志的详细信息，并发送到服务器进行更新处理。


# 5. 编译说明

